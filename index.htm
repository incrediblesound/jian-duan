<html>
	<head>
	<script src="./jquery.js"></script>
	<script src="./underscore.js"></script>
	<script src="./backbone.js"></script>
	<LINK REL="StyleSheet" HREF="./style.css" TYPE="text/css">

  <script src="./passage-data.js"></script>
	<title>Happy Fish</title>
	<script>

	var app;
	var router = Backbone.Router.extend({
		routes: {
			'': 'home',
			'passages/:passageName': 'loadPassage'
		},
		initialize: function(){
			var passages = new Passages();
			passages.reset(passageData);
			this.homeView = new homeView({ collection: passages });
			this.passageView = new passageView({ collection: passages });
		},
		home: function(){
			this.homeView.render();
		},
		loadPassage: function(passageName){
			this.passageView.render(passageName);
		}
	});

	var homeView = Backbone.View.extend({
		el: 'body',
		listEl: '.passage-list',
		template: _.template('<h1>Welcome to Happy Fish</h1><ol class="passage-list">\
		</ol>'),
		initialize: function(){
				
    },
		render: function(){
			this.$el.html(''); // empty the html
      this.$el.html(this.template()); //you want to call teh template so it return a string
			this.collection.each(function(passage){
				var passageSubView = new passageListView({model: passage});
				passageSubView.render();
				this.$el.find(this.listEl).append(passageSubView.$el);
			}, this);
			
		}
	});

	var passageListView = Backbone.View.extend({
		tagName: 'li',
		template: _.template(''
			+'<a href="#passages/<%= ID %>">'
			+'<%= title %></a>'),
		render: function(){
			this.$el.html(this.template(this.model.attributes));
		}
	});

	var Passages = Backbone.Collection.extend({});

	var passageView = Backbone.View.extend({
		template: _.template('<h1><%= attributes.origin %></h1>\
			<h2><%= attributes.title %></h2>\
			<p><%= attributes.trans %></p>\
			'),
		render: function(passageName){
			var passageModel = this.collection.where({
				ID: passageName
			})[0];
			var passageHtml = this.template(passageModel);
			$('body').html(passageHtml);
		}
	});

	$(document).ready(function(){
		app = new router;
		Backbone.history.start();

	});
	</script>
	</head>
		<body>


		</body>
</html>
